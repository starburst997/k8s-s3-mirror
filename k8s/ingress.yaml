# Internal Ingress for wildcard subdomain support (optional)
# This enables virtual-hosted-style S3 requests (bucket.endpoint format)
# Note: Requires an ingress controller like nginx-ingress to be installed
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: s3-proxy-wildcard
  namespace: s3-mirror
  annotations:
    # For nginx-ingress controller
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    # Make this ingress internal-only (not exposed externally)
    kubernetes.io/ingress.class: nginx-internal
    # Or for newer versions:
    # ingressClassName: nginx-internal
spec:
  ingressClassName: nginx-internal  # Use internal ingress class
  rules:
  # Wildcard rule to match any bucket subdomain
  - host: "*.s3.local"  # Change this to your internal domain
    http:
      paths:
      - path: /(.*)
        pathType: Prefix
        backend:
          service:
            name: s3-proxy
            port:
              number: 80